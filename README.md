## windows Pe malware detection using Ensamble learning

<h1>Introduction</h1>

- Malware detection is the process of ascertaining the presence of malware on a system or determining whether a program is malicious or harmless so that the system can be protected or recovered from any effects caused by the malicious code .<br>
- As the number of legitimate users of the Internet increases, so do the opportunities for cybercriminals to gain from manufacturing malware.<br>
- This is the reason that prompted the authors of the [article](https://www.mdpi.com/2227-9709/8/1/10) we investigated to develop a model for predicting whether a PE file is malicious or benign by methods of deep 
  learning and group learning.<br>
- We implemented the idea in the models and tried to slightly improve the results, which we did manage to do eventually.<br>
- We used the [dataset](https://www.kaggle.com/datasets/amauricio/pe-files-malwares/data) of the research from Kaggle.<br>

<h2>Getting know the data </h2>

-  The data contains 19611 rows, and 79 columns <br>

![Picture1](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/c34f122e-346d-45f0-b337-58c43ea0af05) 

![Picture2](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/a29a9efb-0169-40b1-8b61-98d20d1bafa4)

![Picture3](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/1cc2a1fe-596d-40e5-a36c-ce5ba582e3b1)

<h2>Getting know the data</h2>

- Although The data is a bit biased to the “Malware” cluster, we have enough data such that the model will be able to learn all the labels well.
  
![Picture4](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/e91b6b4c-9ab1-4516-80b0-7b69570e7c4f) 

- We would like to check the correlation of the features to the label: “Malware”, but still the correlations aren’t compromising

  ![Picture5](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/6f4bdb84-2f64-4907-adf7-370d86dc431d)
  
  ![Picture6](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/164b674d-0eda-4aca-8db2-ef8be119b4f1)

  <h2>Dimensionality Reduction </h2>

  - Following the research work - we used PCA to reduce the number of columns to 55, as determined by the researchers.
  - Before that, we carried out our own research and found that in advance we could not refer to 4 columns ('Name', 'Machine’, 'TimeDateStamp', and the target 
    label 'Malware’ that mustn’t be reduced) that represent general or not significant information so that it does not constitute an impact on the data

    ![Picture7](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/18b0dc2d-aefe-4979-834e-54b06eb9330a)

    <h2>Pre-Processing</h2>

    - In the last stage we split the data to trains and tests sets 

![Picture8](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/f4afd429-3e36-4964-b2c6-1e7c151f03f4)

<h2> ‘adam’ OPTIMIZER </h2>
- Adam (Adaptive Moment Estimation) helps minimize the loss function by iteratively adjusting the learning rate for each parameter in the model based on past gradients by fast convergence (if the loss is high – the adjustment in the learning rate will be much more significant than if the loss is low)

<h2> Malware Detection Using Machine Learning</h2>

- This code uses scikit-learn to build and evaluate machine learning models for malware detection. The code snippet below demonstrates how to train several classifiers, including Naive Bayes, Decision Tree, Random Forest, AdaBoost, and Gradient Boosting, on a dataset split into training and testing sets. It then evaluates each classifier's performance using a confusion matrix, highlighting the recall score for each classifier, which indicates the proportion of actual positives that were correctly identified. The confusion matrix is visualized using ConfusionMatrixDisplay from scikit-learn. This implementation is based on the techniques described in  [article](https://www.mdpi.com/2227-9709/8/1/10)  .

  <h2> Models Building:</h2>
- Gaussian Naïve Bayes,
- Decision Tree,
- Random Forest, 
- AdaBoost, 
- Gradient Boosting

![Screenshot 2024-04-11 121529](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/6c79f786-5206-4281-be4b-c8b6f6142b46)


![Screenshot 2024-04-11 121605](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/3e933405-46ce-4545-9c53-24448b4a9c29)

<h2>Deep learning models</h2>
<h3>Malware Detection Using MLP Classifier </h3>
- This code implements a Multi-Layer Perceptron (MLP) classifier from scikit-learn to train a deep learning model for malware detection. The code snippet below demonstrates how to create and train an MLP classifier with three hidden layers (128, 64, and 32 units) using the ReLU activation function and the Adam optimizer. The model is trained using 5-fold cross-validation to evaluate its performance. After training, the model is used to make predictions on the test set, and the accuracy of the classifier is evaluated. This implementation is based on the techniques described in [article](https://www.mdpi.com/2227-9709/8/1/10) .

![Screenshot 2024-04-11 124122](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/e990fb7f-77d8-4f43-91f6-43ca8d2a5bc6)

<h2>Malware Detection Using 1D CNN Model</h2>

- This code  utilizes a 1D Convolutional Neural Network (CNN) implemented with TensorFlow/Keras to train a deep learning model for malware detection. The code snippet below defines a CNN model architecture with two convolutional layers followed by max pooling layers, flattening, and two dense layers. The model is compiled with the Adam optimizer and binary crossentropy loss function. It is then trained on a dataset split into training and testing sets, and its performance is evaluated using the test set. This implementation is based on the techniques described in [article](https://www.mdpi.com/2227-9709/8/1/10) .

  ![Screenshot 2024-04-11 135443](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/883d1d67-bb47-4c9f-b2ea-08aa93ffbb82)


<h2>Malware Detection Using Ensemble Learning </h2>
- This code uses ensemble learning to improve malware detection performance. The code snippet below demonstrates how to train an ensemble of classifiers, including Gaussian Naive Bayes, Decision Tree, Random Forest, AdaBoost, and Gradient Boosting, on a dataset split into training and testing sets. Each base classifier is trained using cross-validation, and their predictions are combined to create new features. A final classifier (Random Forest) is then trained on these new features to make ensemble predictions. The performance of the ensemble model is evaluated using the test set, and the accuracy is calculated. This implementation is based on the techniques described in [article](https://www.mdpi.com/2227-9709/8/1/10) .

![Screenshot 2024-04-11 140249](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/d2d32412-9cc3-47c7-970e-8387535d5161)

<h2>Ensemble Learning with Final-Stage Classifiers </h2>

- This code evaluates various final-stage classifiers for ensemble learning in malware detection. The code snippet below defines a set of classifiers, including Decision Tree, SVM with linear and RBF kernels, Random Forest, AdaBoost, Extra Trees, K-Nearest Neighbors, Gaussian Naive Bayes, Linear Discriminant Analysis, Quadratic Discriminant Analysis, Logistic Regression, Passive Aggressive, Ridge Classifier, SGD, and Isolation Forest. Each classifier is trained on the new features generated from base classifiers and evaluated using the training set. The classifiers are sorted based on their accuracy scores in descending order. This implementation is based on the techniques described in [article](https://www.mdpi.com/2227-9709/8/1/10)

![Screenshot 2024-04-11 141723](https://github.com/ohadtaizi/Microsoft-PE-malware-detection/assets/74296478/ea126cf3-ab78-478d-8a49-baded4b5115a)

<h2>The results we reached </h2>


| Metalearner |     our  | their |
|:-----|:--------:|------:|
| Decision Tree  |  0.99981 | 0.989 |
|Random Forest  |  0.99981  |   0.9924 |
| Extra Trees  | 0.99981 |    1 |
| KNN   |0.98266 |   0.979|
| LDA   |  0.97705 |    0.98 |
| AdaBoost   |0.97673 |    0.982 |
| SVM   |0.97654 |    0.982 |
| Logistic   |0.97642 |    0.981 |
| SGD   | 0.97508 |    0.979 |
| Passive   |0.97444 |    0.978|
| Gaussian   | 0.97291 |    0.972 |
| QDA   | 0.96577 |    0.973 |
.



  
















